---
import { Box } from "@mui/joy";
import blogJson from "../../generated/blogs.json";
import { BlogNavigation } from "../components/Blog/BlogNavigation";
import { LanguageFallbackNotice } from "../components/Blog/LanguageFallbackNotice";
import { Typography } from "../components/Typography";
import type { Languages } from "../i18n/ui";
import {
  getAvailableLanguagesForSlug,
  getPreviousAndNextBlog,
} from "../utils/blogUtils";
import type { BlogSchema } from "../utils/microcms";
import Layout from "./Layout.astro";

type Props = {
  blog: BlogSchema;
  lang: Languages;
};

const { blog, lang } = Astro.props;

// 同じslugを持つ全ブログの言語を取得
const blogs = blogJson.contents as BlogSchema[];
const availableLanguagesForSlug = getAvailableLanguagesForSlug(
  blogs,
  blog.slug,
);

const isCurrentLanguageSupported = availableLanguagesForSlug.includes(lang);

// 前の記事・次の記事を取得
const { previousBlog, nextBlog } = getPreviousAndNextBlog(blogs, blog.slug);
---

<Layout title={blog.title} description={""} lang={lang} noindex={!isCurrentLanguageSupported}>
  <Box sx={{
    padding: { xs: "1rem", sm: "2rem" },
    maxWidth: "800px",
    margin: "0 auto",
    figure: {
      margin: "0",
      textAlign: "center",
    },
    img: {
      width: "60%",
      height: "auto",
    },
  }}>
  <LanguageFallbackNotice blog={blog} currentLang={lang} availableLanguagesForSlug={availableLanguagesForSlug} client:load />
  <Typography>{blog.createdAt}</Typography>
  <Box set:html={blog.content} sx={{
    "& p": {
      wordBreak: "break-all",
      textWrap: "auto",
    },
  }}/>
  <BlogNavigation previousBlog={previousBlog} nextBlog={nextBlog} currentLang={lang} client:load />      
  </Box>
</Layout>
